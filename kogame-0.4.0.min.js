/*! Kogame.js - v0.4.0 - 2012-11-12
* https://github.com/kobingo/kogame.js
* Copyright (c) 2012 Jens Andersson; Licensed MIT */
var ko=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,n=function(){e.game.update(.016),t(n)},r=function(){};return r.prototype.init=function(t){var n=document.getElementById(t);if(!n)throw new Error("Couldn't find canvas '"+t+"'");e.renderer=new e.Renderer(n),this.initialized=!0},r.prototype.run=function(r){if(!this.initialized)throw new Error("Game has not been initialized");e.director.scene=r,t(n)},r.prototype.update=function(t){e.director.update(t),e.renderer.clear(),e.director.render(),e.keyboard.update(),e.mouse.update()},e.game=new r,e}(ko||{}),ko=function(e){var t={},n={},r={},i=function(){this.ENTER=13,this.ESCAPE=27,this.SPACE=32,this.LEFT=37,this.UP=38,this.RIGHT=39,this.DOWN=40,window.addEventListener("keydown",function(e){t[e.keyCode]||(n[e.keyCode]=!0),t[e.keyCode]=!0,r[e.keyCode]=!0},!1),window.addEventListener("keyup",function(e){t[e.keyCode]=!1},!1)};return i.prototype.update=function(){n={},r={}},i.prototype.isKeyDown=function(e){return t[e]},i.prototype.wasKeyPressed=function(e){return n[e]},i.prototype.wasKeyHeld=function(e){return r[e]},e.keyboard=new i,e}(ko||{}),ko=function(e){var t,n,r=function(){var e=this;this.position={x:0,y:0},this.moved={x:0,y:0},window.addEventListener("mousemove",function(t){e.position.x!==0&&(e.moved.x=t.offsetX-e.position.x),e.position.y!==0&&(e.moved.y=t.offsetY-e.position.y),e.position.x=t.offsetX,e.position.y=t.offsetY},!1),window.addEventListener("mousedown",function(e){t||(n=!0),t=!0},!1),window.addEventListener("mouseup",function(e){t=!1},!1)};return r.prototype.update=function(){this.moved.x=0,this.moved.y=0,n=!1},r.prototype.isButtonDown=function(){return t},r.prototype.wasButtonPressed=function(){return n},e.mouse=new r,e}(ko||{}),ko=function(e){return e.Renderer=function(e){this.canvas=e,this.context=e.getContext("2d"),this.clearColor="rgb(100, 149, 237)",this.size={width:e.width,height:e.height},this.center={x:e.width/2,y:e.height/2}},e.Renderer.prototype.clear=function(){this.context.globalAlpha=1,this.context.fillStyle=this.clearColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},e.Renderer.prototype.beginTransform=function(e){this.context.save(),this.context.translate(e.position.x,e.position.y),this.context.scale(e.scale,e.scale),this.context.rotate(e.rotation)},e.Renderer.prototype.endTransform=function(){this.context.restore()},e.Renderer.prototype.drawRect=function(e){this.context.globalAlpha=e.opacity,this.context.fillStyle=e.color,this.context.fillRect(e.anchor.x*-e.size.width,e.anchor.y*-e.size.height,e.size.width,e.size.height)},e.Renderer.prototype.drawSprite=function(e){this.context.globalAlpha=e.opacity,this.context.drawImage(e.image,e.anchor.x*-e.size.width,e.anchor.y*-e.size.height)},e.Renderer.prototype.drawLabel=function(e){this.context.fillStyle=e.color,this.context.font=e.font,this.context.globalAlpha=e.opacity,this.context.fillText(e.text,e.anchor.x*-e.size.width,e.anchor.y*-e.size.height)},e.Renderer.prototype.getLabelSize=function(e){this.context.font=e.font;var t=this.context.measureText(e.text);return{width:t.width,height:0}},e}(ko||{}),ko=function(e){return e.Node=function(e){this.position={x:0,y:0},this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.color="rgb(255,255,255)",this.opacity=1,this.rotation=0,this.scale=1,this.anchor={x:0,y:0},this.size={width:0,height:0},this.visible=!0,this._children=[],this._actions=[],this._update=e||function(e){},this._render=function(){}},e.Node.prototype.update=function(e){this.velocity.x+=this.acceleration.x,this.velocity.y+=this.acceleration.y,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;var t;for(t=0;t<this._actions.length;t++)this._actions[t].update(e);for(t=0;t<this._children.length;t++)this._children[t].update(e);this._update(e)},e.Node.prototype.render=function(){if(!this.visible)return;e.renderer.beginTransform(this),this._render(),this.renderChildren(),e.renderer.endTransform()},e.Node.prototype.renderChildren=function(){for(var e=0;e<this._children.length;e++)this._children[e].render()},e.Node.prototype.addChild=function(e){if(e===this)throw new Error("Can't add a child to itself");if(e.parent)throw new Error("Child already has a parent");this._children.push(e),e.parent=this},e.Node.prototype.perform=function(e){if(e.target)throw new Error("Action is already in use");e.init(this),this._actions.push(e)},e.Node.prototype.moveTo=function(t,n,r,i){return this.perform(new e.MoveTo(t,n,r,i)),this},e.Node.prototype.scaleTo=function(t,n,r){return this.perform(new e.ScaleTo(t,n,r)),this},e.Node.prototype.rotateTo=function(t,n,r){return this.perform(new e.RotateTo(t,n,r)),this},e.Node.prototype.fadeTo=function(t,n,r){return this.perform(new e.FadeTo(t,n,r)),this},e.Node.prototype.sequence=function(t){var n=new e.Sequence([],t);return this._actions.push(n),n},e.Node.prototype.isColliding=function(t,n){return this.boundingBox||(this.boundingBox=new e.BoundingBox(this)),t.boundingBox||(t.boundingBox=new e.BoundingBox(t)),this.boundingBox.isIntersecting(t.boundingBox,n)},e}(ko||{}),ko=function(e){return e.Sprite=function(t,n){e.Node.call(this,n),t instanceof Image?this.image=t:(this.image=new Image,this.image.src=t),this.anchor={x:.5,y:.5};var r=this;this.image.addEventListener("load",function(){r.size={width:r.image.width,height:r.image.height}}),this._render=function(){e.renderer.drawSprite(this)}},e.Sprite.prototype=Object.create(e.Node.prototype),e}(ko||{}),ko=function(e){return e.Label=function(t,n){e.Node.call(this),this.setText(t),this.setFont(n),this._render=function(){e.renderer.drawLabel(this)}},e.Label.prototype=Object.create(e.Node.prototype),e.Label.prototype.setText=function(t){this.text=t,this.size=e.renderer.getLabelSize(this)},e.Label.prototype.setFont=function(t){this.font=t,this.size=e.renderer.getLabelSize(this)},e}(ko||{}),ko=function(e){return e.BoundingBox=function(e){this.node=e},e.BoundingBox.prototype.isIntersecting=function(e,t){var n={x:this.node.position.x,y:this.node.position.y,w:this.node.size.width,h:this.node.size.height};n.l=n.x-n.w*this.node.anchor.x,n.r=n.x+n.w*(1-this.node.anchor.x),n.t=n.y-n.h*this.node.anchor.y,n.b=n.y+n.h*(1-this.node.anchor.y);var r={x:e.node.position.x,y:e.node.position.y,w:e.node.size.width,h:e.node.size.height};r.l=r.x-r.w*e.node.anchor.x,r.r=r.x+r.w*(1-e.node.anchor.x),r.t=r.y-r.h*e.node.anchor.y,r.b=r.y+r.h*(1-e.node.anchor.y);if(n.r<=r.l||n.l>=r.r||n.b<=r.t||n.t>=r.b)return!1;if(!t)return!0;var i=Math.min(Math.abs(n.r-r.l),Math.abs(r.r-n.l)),s=Math.min(Math.abs(n.b-r.t),Math.abs(r.b-n.t));return i<s?n.l<r.l?this.node.position.x=r.l-n.w*(1-this.node.anchor.x):this.node.position.x=r.r+n.w*this.node.anchor.x:n.t<r.t?this.node.position.y=r.t-n.h*(1-this.node.anchor.y):this.node.position.y=r.b+n.h*this.node.anchor.y,!0},e}(ko||{}),ko=function(e){return e.Action=function(e,t){this.duration=e,this.ease=t,this.value=0,this.elapsed=0},e.Action.prototype.init=function(e){this.value=0,this.target=e,this.elapsed=0},e.Action.prototype.update=function(e){if(!this.target)throw new Error("Action has not been initialized with a target");if(!this.duration){this.value=1,this.perform();return}this.elapsed+=e,this.elapsed>this.duration&&(this.elapsed=this.duration),this.ease?this.value=this.ease(this.elapsed/this.duration):this.value=Math.max(0,Math.min(1,this.elapsed/this.duration)),this.perform()},e.Action.prototype.perform=function(){},e.Action.prototype.isComplete=function(){return this.elapsed>=this.duration},e.MoveTo=function(t,n,r,i){e.Action.call(this,r,i),this.moveTo={x:t,y:n}},e.MoveTo.prototype=Object.create(e.Action.prototype),e.MoveTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.moveFrom={x:t.position.x,y:t.position.y}},e.MoveTo.prototype.perform=function(){this.target.position.x=this.moveFrom.x+(this.moveTo.x-this.moveFrom.x)*this.value,this.target.position.y=this.moveFrom.y+(this.moveTo.y-this.moveFrom.y)*this.value},e.ScaleTo=function(t,n,r){e.Action.call(this,n,r),this.scaleTo=t},e.ScaleTo.prototype=Object.create(e.Action.prototype),e.ScaleTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.scaleFrom=t.scale},e.ScaleTo.prototype.perform=function(){this.target.scale=this.scaleFrom+(this.scaleTo-this.scaleFrom)*this.value},e.RotateTo=function(t,n,r){e.Action.call(this,n,r),this.rotateTo=t},e.RotateTo.prototype=Object.create(e.Action.prototype),e.RotateTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.rotateFrom=t.rotation},e.RotateTo.prototype.perform=function(){this.target.rotation=this.rotateFrom+(this.rotateTo-this.rotateFrom)*this.value},e.FadeTo=function(t,n,r){e.Action.call(this,n,r),this.fadeTo=t},e.FadeTo.prototype=Object.create(e.Action.prototype),e.FadeTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.fadeFrom=t.opacity},e.FadeTo.prototype.perform=function(){this.target.opacity=this.fadeFrom+(this.fadeTo-this.fadeFrom)*this.value},e.Wait=function(t){e.Action.call(this,t)},e.Wait.prototype=Object.create(e.Action.prototype),e.actionEase={backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return e-=1,e*e*((t+1)*e+t)+1},backInOut:function(e){var t=2.5949095;return e*=2,e<1?e*e*((t+1)*e-t)/2:(e-=2,e*e*((t+1)*e+t)/2+1)},sineIn:function(e){return-1*Math.cos(e*Math.PI*2)+1},sineOut:function(e){return Math.sin(e*Math.PI*2)},sineInOut:function(e){return-0.5*(Math.cos(Math.PI*e)-1)}},e}(ko||{}),ko=function(e){return e.Sequence=function(e,t){this._actions=e,this.repeatCount=t,this.actionIndex=0,this.loopCount=0},e.Sequence.prototype=Object.create(e.Action.prototype),e.Sequence.prototype.init=function(e){this.actionIndex=0,this.loopCount=0,this._actions.length>0&&this._actions[0].init(e),this.target=e},e.Sequence.prototype.update=function(e){if(this._actions.length===0)return;if(this.loopCount>=this.repeatCount)return;var t=this._actions[this.actionIndex];t.update(e);while(t.isComplete())this.nextAction(),t=this._actions[this.actionIndex],t.duration||t.update(e)},e.Sequence.prototype.isComplete=function(){return this.repeatCount?this.loopCount>=this.repeatCount:!1},e.Sequence.prototype.nextAction=function(){this.actionIndex++,this.actionIndex>=this._actions.length&&(this.actionIndex=0,this.loopCount++),this._actions[this.actionIndex].init(this.target)},e.Sequence.prototype.moveTo=function(t,n,r,i){return this._actions.push(new e.MoveTo(t,n,r,i)),this},e.Sequence.prototype.scaleTo=function(t,n,r){return this._actions.push(new e.ScaleTo(t,n,r)),this},e.Sequence.prototype.rotateTo=function(t,n,r){return this._actions.push(new e.RotateTo(t,n,r)),this},e.Sequence.prototype.fadeTo=function(t,n,r){return this._actions.push(new e.FadeTo(t,n,r)),this},e.Sequence.prototype.wait=function(t){return this._actions.push(new e.Wait(t)),this},e}(ko||{}),ko=function(e){var t=function(){this.fadeTransition=new n};t.prototype.update=function(e){if(!this.scene)return;this.scene.update(e),this.fadeTransition.update(e)},t.prototype.render=function(){if(!this.scene)return;this.scene.render(),this.fadeTransition.render()},t.prototype.fadeTo=function(e,t,n){this.fadeTransition.fadeTo(e,t,n)};var n=function(){this.value=0,this.update=function(t){if(!this.fadeToAction)return;var n=this.fadeToScene?!0:!1;this.fadeToAction.update(t),n?(this.value=this.fadeToAction.value,this.fadeToAction.isComplete()&&(e.director.scene=this.fadeToScene,this.fadeToAction.init(),delete this.fadeToScene)):(this.value=1-this.fadeToAction.value,this.fadeToAction.isComplete()&&delete this.fadeToAction)},this.render=function(t){this.value>0&&e.renderer.drawRect(this.color,this.value)},this.fadeTo=function(t,n,r){if(this.fadeToAction)return;this.fadeToScene=t,this.duration=n||1,this.color=r||"rgb(0,0,0)",this.fadeToAction=new e.Action(this.duration/2,e.actionEase.sineInOut)}};return e.director=new t,e}(ko||{}),ko=function(e){return e.Scene=function(t){e.Node.call(this,t),this.anchor={x:.5,y:.5}},e.Scene.prototype=Object.create(e.Node.prototype),e}(ko||{}),ko=function(e){return e.Menu=function(t,n,r){e.Node.call(this),this.itemColor="rgb(255,255,255)",this.selectedItemColor="rgb(255,215,0)",this.selectedItemIndex=0,this.spacing=10,this.fontSize=t,this.font=t+"px "+n,this._items=r,this.createLabels(),this.alignItemsCenter()},e.Menu.prototype=Object.create(e.Node.prototype),e.Menu.prototype.update=function(t){e.Node.prototype.update.call(this,t),this.handleInput();for(var n=0;n<this._labels.length;n++)this._labels[n].color=n===this.selectedItemIndex?this.selectedItemColor:this.itemColor},e.Menu.prototype.handleInput=function(){e.keyboard.wasKeyHeld(e.keyboard.UP)?this.prevItem():e.keyboard.wasKeyHeld(e.keyboard.DOWN)&&this.nextItem(),e.keyboard.wasKeyPressed(e.keyboard.ENTER)&&this.selectItem()},e.Menu.prototype.createLabels=function(){this._labels=[];for(var t=0;t<this._items.length;t++){var n=new e.Label(this._items[t],this.font);this._labels.push(n),this.addChild(n)}},e.Menu.prototype.alignItemsCenter=function(){var t=this,n=function(e){var n=t._labels.length-1,r=t.spacing,i=t.fontSize;return-(n*i+n*r)/2+(i+r)*e};for(var r=0;r<this._items.length;r++)this._labels[r].position={x:0,y:n(r)},this._labels[r].anchor={x:.5,y:.5};this.position={x:e.renderer.size.width/2,y:e.renderer.size.height/2}},e.Menu.prototype.nextItem=function(){this.selectedItemIndex<this._items.length-1&&this.selectedItemIndex++},e.Menu.prototype.prevItem=function(){this.selectedItemIndex>0&&this.selectedItemIndex--},e.Menu.prototype.selectItem=function(){if(!this.itemSelected)return;this.itemSelected()},e}(ko||{});