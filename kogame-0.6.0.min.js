/*! Kogame.js - v0.6.0 - 2012-12-16
* https://github.com/kobingo/kogame.js
* Copyright (c) 2012 Jens Andersson; Licensed MIT */
var ko=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},n=window.performance||{};n.now=n.now||n.webkitNow||n.mozNow||n.oNow||n.msNow||function(){return(new Date).getTime()};var r=n.now(),i=0,s=function(){var o=n.now(),u=o-r;r=o,i+=u;while(i>=e.game.targetDelta)e.game.update(e.game.targetDelta*.001),i-=e.game.targetDelta;e.game.draw(),t(s)},o,u=function(){this.targetDelta=1e3/60};return u.prototype.init=function(t){o=document.getElementById(t);if(!o)throw new Error("Couldn't find canvas '"+t+"'");e.graphics.init(o),e.mouse.init(o),this.initialized=!0},u.prototype.run=function(n){if(!this.initialized)throw new Error("Game has not been initialized");e.director.scene=n,t(s)},u.prototype.update=function(t){e.director.update(t),e.keyboard.update(),e.mouse.update(),e.audio.update(t)},u.prototype.draw=function(){e.graphics.clear(),e.director.draw()},u.prototype.toggleFullscreen=function(){if(!o)return;var e=o.requestFullScreen||o.webkitRequestFullScreen||o.mozRequestFullScreen||o.oRequestFullScreen||o.msRequestFullScreen,t=document.isFullScreen||document.webkitIsFullScreen||document.mozIsFullScreen||document.oIsFullScreen||document.msIsFullScreen,n=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.oCancelFullScreen||document.msCancelFullScreen;!t&&e?e.call(o):n&&n.call(document)},u.prototype.autoCenterAndScaleToFit=function(){window.addEventListener("resize",function(){e()});var e=function(){if(!o)return;var e=Math.min(window.innerWidth/o.width,window.innerHeight/o.height);o.style.width=o.width*e+"px",o.style.height=o.height*e+"px",o.style.position="absolute",o.style.left=(window.innerWidth-o.width*e)/2+"px",o.style.top=(window.innerHeight-o.height*e)/2+"px"};e()},e.game=new u,e}(ko||{}),ko=function(e){var t={},n={},r={},i=function(){this.ENTER=13,this.ESCAPE=27,this.SPACE=32,this.LEFT=37,this.UP=38,this.RIGHT=39,this.DOWN=40,window.addEventListener("keydown",function(e){t[e.keyCode]||(n[e.keyCode]=!0),t[e.keyCode]=!0,r[e.keyCode]=!0},!1),window.addEventListener("keyup",function(e){t[e.keyCode]=!1},!1)};return i.prototype.update=function(){n={},r={}},i.prototype.isKeyDown=function(e){return t[e]},i.prototype.wasKeyPressed=function(e){return n[e]},i.prototype.wasKeyHeld=function(e){return r[e]},e.keyboard=new i,e}(ko||{}),ko=function(e){var t,n;return e.Mouse=function(){var e=this;this.position={x:0,y:0},this.local={x:0,y:0},this.moved={x:0,y:0},this.hasEntered=!1,window.addEventListener("mousemove",function(t){e.position.x!==0&&(e.moved.x=t.offsetX-e.position.x),e.position.y!==0&&(e.moved.y=t.offsetY-e.position.y),e.position.x=t.clientX,e.position.y=t.clientY},!1),window.addEventListener("mousedown",function(e){t||(n=!0),t=!0},!1),window.addEventListener("mouseup",function(e){t=!1},!1)},e.Mouse.prototype.init=function(e){var t=this;e.addEventListener("mousemove",function(e){t.local.x=e.offsetX,t.local.y=e.offsetY},!1),e.addEventListener("mouseover",function(e){t.hasEntered=!0},!1),e.addEventListener("mouseout",function(e){t.hasEntered=!1},!1)},e.Mouse.prototype.update=function(){this.moved.x=0,this.moved.y=0,n=!1},e.Mouse.prototype.isButtonDown=function(){return t},e.Mouse.prototype.wasButtonPressed=function(){return n},e.mouse=new e.Mouse,e}(ko||{}),ko=function(e){return e.Graphics2D=function(){},e.Graphics2D.prototype.init=function(e){this.canvas=e,this.context=e.getContext("2d"),this.width=e.width,this.height=e.height,this.center={x:e.width/2,y:e.height/2}},e.Graphics2D.prototype.clear=function(e,t){t===undefined&&(t=1),this.context.globalAlpha=t,this.context.fillStyle=e||"rgb(100, 149, 237)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},e.Graphics2D.prototype.beginTransform=function(e){this.context.save(),this.context.translate(e.position.x,e.position.y),this.context.scale(e.scale,e.scale),this.context.rotate(e.rotation),this.context.translate(-e.camera.x,-e.camera.y)},e.Graphics2D.prototype.endTransform=function(){this.context.restore()},e.Graphics2D.prototype.drawRect=function(e){this.context.globalAlpha=e.opacity,this.context.fillStyle=e.color,this.context.fillRect(e.anchor.x*-e.size.width,e.anchor.y*-e.size.height,e.size.width,e.size.height)},e.Graphics2D.prototype.drawSprite=function(e){this.context.globalAlpha=e.opacity,this.context.drawImage(e.image,e.anchor.x*-e.size.width,e.anchor.y*-e.size.height)},e.Graphics2D.prototype.drawLabel=function(e){this.context.fillStyle=e.color,this.context.font=e.font,this.context.textAlign=e.align,this.context.textBaseline=e.baseline,this.context.globalAlpha=e.opacity,this.context.fillText(e.text,0,0)},e.graphics=new e.Graphics2D,e}(ko||{}),ko=function(e){return e.Node=function(){this.position={x:0,y:0},this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.color="rgb(255,255,255)",this.opacity=1,this.rotation=0,this.scale=1,this.anchor={x:0,y:0},this.size={width:0,height:0},this.camera={x:0,y:0},this.visible=!0,this.active=!0,this.children=[],this.actions=[],this.onUpdate=function(e){},this.onHandleInput=function(){},this.onDraw=function(){}},e.Node.prototype.update=function(e){if(!this.active)return;this.velocity.x+=this.acceleration.x,this.velocity.y+=this.acceleration.y,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;var t;for(t=0;t<this.actions.length;t++)this.actions[t].update(e);for(t=this.actions.length-1;t>=0;t--)this.actions[t].isComplete()&&(this.actions[t].target=null,this.actions.splice(t,1));for(t=0;t<this.children.length;t++)this.children[t].update(e);this.onUpdate(e)},e.Node.prototype.draw=function(){if(!this.visible)return;e.graphics.beginTransform(this),this.onDraw();for(var t=0;t<this.children.length;t++)this.children[t].draw();e.graphics.endTransform()},e.Node.prototype.handleInput=function(){this.onHandleInput();for(var e=0;e<this.children.length;e++)this.children[e].handleInput()},e.Node.prototype.addChild=function(e){if(e===this)throw new Error("Can't add a child to itself");if(e.parent)throw new Error("Child already has a parent");this.children.push(e),e.parent=this},e.Node.prototype.getAllChildren=function(){var e=[],t=function(n){for(var r=0;r<n.children.length;r++)e.push(n.children[r]),t(n.children[r])};return t(this),e},e.Node.prototype.performAction=function(e){if(e.target)throw new Error("Action is already in use");e.init(this),this.actions.push(e)},e.Node.prototype.stopAction=function(e){var t=this.actions.indexOf(e);if(t<0)return;this.actions[t].target=null,this.actions.splice(t,1)},e.Node.prototype.moveTo=function(t,n,r,i){this.performAction(new e.MoveTo(t,n,r,i))},e.Node.prototype.moveBy=function(t,n,r,i){this.performAction(new e.MoveBy(t,n,r,i))},e.Node.prototype.scaleTo=function(t,n,r){this.performAction(new e.ScaleTo(t,n,r))},e.Node.prototype.scaleBy=function(t,n,r){this.performAction(new e.ScaleBy(t,n,r))},e.Node.prototype.rotateTo=function(t,n,r){this.performAction(new e.RotateTo(t,n,r))},e.Node.prototype.rotateBy=function(t,n,r){this.performAction(new e.RotateBy(t,n,r))},e.Node.prototype.fadeTo=function(t,n,r){this.performAction(new e.FadeTo(t,n,r))},e.Node.prototype.fadeBy=function(t,n,r){this.performAction(new e.FadeBy(t,n,r))},e.Node.prototype.performSequence=function(t){var n=new e.Sequence([],t);return this.performAction(n),n},e.Node.prototype.setPosition=function(e){this.position={x:e.x,y:e.y}},e.Node.prototype.setCamera=function(e){this.camera={x:e.x,y:e.y}},e.Node.prototype.centerAnchor=function(){this.anchor={x:.5,y:.5}},e}(ko||{}),ko=function(e){return e.Sprite=function(t){e.Node.call(this),t&&this.setImage(t),this.onDraw=function(){if(!this.image)return;e.graphics.drawSprite(this)}},e.Sprite.prototype=Object.create(e.Node.prototype),e.Sprite.prototype.update=function(t){e.Node.prototype.update.call(this,t),this.animation&&(this.animation.update(t),this.image=this.animation.getFrameImage())},e.Sprite.prototype.setImage=function(e){if(!e)throw new Error("'image' can not be empty when setting image on sprite.");e instanceof Image?this.image=e:(this.image=new Image,this.image.src=e);var t=this;this.image.addEventListener("load",function(){t.size={width:t.image.width,height:t.image.height}})},e.Sprite.prototype.playAnimation=function(e){this.animation=e,this.animation.init()},e.Sprite.prototype.stopAnimation=function(){this.animation=null},e}(ko||{}),ko=function(e){return e.Animation=function(t,n){if(!t||t.length===0)throw new Error("'images' can not be empty when creating animation.");this.frames=[],this.frameIndex=0;for(var r=0;r<t.length;r++)if(t[r]instanceof Image)this.frames.push(t[r]);else{var i=new Image;i.src=t[r],this.frames.push(i)}var s=this;this.sequence=new e.Sequence,this.sequence.wait(1/(n||30)).call(function(){s.frameIndex=(s.frameIndex+1)%s.frames.length})},e.Animation.prototype.update=function(e){this.sequence.update(e)},e.Animation.prototype.init=function(){this.sequence.init()},e.Animation.prototype.getFrameImage=function(){return this.frames[this.frameIndex]},e}(ko||{}),ko=function(e){return e.Label=function(t,n,r){e.Node.call(this,r),this.text=t,this.font=n,this.baseline="top",this.align="left",this.onDraw=function(){e.graphics.drawLabel(this)}},e.Label.prototype=Object.create(e.Node.prototype),e}(ko||{}),ko=function(e){return e.boundingBox={isIntersecting:function(t,n,r){if(t.parent!==n.parent)throw new Error("Both nodes must have the same parent when testing bounding box intersection.");var i={x:t.position.x,y:t.position.y,w:t.size.width,h:t.size.height};i.l=i.x-i.w*t.anchor.x,i.r=i.x+i.w*(1-t.anchor.x),i.t=i.y-i.h*t.anchor.y,i.b=i.y+i.h*(1-t.anchor.y);var s={x:n.position.x,y:n.position.y,w:n.size.width,h:n.size.height};s.l=s.x-s.w*n.anchor.x,s.r=s.x+s.w*(1-n.anchor.x),s.t=s.y-s.h*n.anchor.y,s.b=s.y+s.h*(1-n.anchor.y);if(i.r<=s.l||i.l>=s.r||i.b<=s.t||i.t>=s.b)return e.boundingBox.intersection.NONE;var o=e.boundingBox.intersection.NONE,u={x:t.position.x,y:t.position.y},a=Math.min(Math.abs(i.r-s.l),Math.abs(s.r-i.l)),f=Math.min(Math.abs(i.b-s.t),Math.abs(s.b-i.t));return a<f?i.l<s.l?(u.x=s.l-i.w*(1-t.anchor.x),o=e.boundingBox.intersection.RIGHT):(u.x=s.r+i.w*t.anchor.x,o=e.boundingBox.intersection.LEFT):i.t<s.t?(u.y=s.t-i.h*(1-t.anchor.y),o=e.boundingBox.intersection.BOTTOM):(u.y=s.b+i.h*t.anchor.y,o=e.boundingBox.intersection.TOP),r&&t.setPosition(u),o},intersection:{NONE:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4}},e.boundingSphere={isIntersecting:function(e,t){if(e.parent!==t.parent)throw new Error("Both nodes must have the same parent when testing bounding sphere intersection.");if(!e.radius||!t.radius)throw new Error("Both nodes must have a radius when testing for bounding sphere intersection.");var n=e.position.x-t.position.x,r=e.position.y-t.position.y,i=Math.sqrt(n*n+r*r);return i<=e.radius+t.radius?!0:!1}},e}(ko||{}),ko=function(e){return e.Action=function(e,t){this.duration=e,this.actionEase=t,this.value=0,this.elapsed=0},e.Action.prototype.init=function(e){this.value=0,this.target=e,this.elapsed=0},e.Action.prototype.update=function(e){if(!this.duration){this.value=1,this.perform();return}if(this.isComplete())return;this.elapsed+=e,this.elapsed>this.duration&&(this.elapsed=this.duration),this.actionEase?this.value=this.actionEase(this.elapsed/this.duration):this.value=Math.max(0,Math.min(1,this.elapsed/this.duration)),this.perform()},e.Action.prototype.perform=function(){},e.Action.prototype.isComplete=function(){return this.duration?this.elapsed>=this.duration:!0},e.MoveTo=function(t,n,r,i){e.Action.call(this,r,i),this.moveTo={x:t,y:n}},e.MoveTo.prototype=Object.create(e.Action.prototype),e.MoveTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.moveFrom={x:t.position.x,y:t.position.y}},e.MoveTo.prototype.perform=function(){this.target.position.x=this.moveFrom.x+(this.moveTo.x-this.moveFrom.x)*this.value,this.target.position.y=this.moveFrom.y+(this.moveTo.y-this.moveFrom.y)*this.value},e.MoveBy=function(t,n,r,i){e.Action.call(this,r,i),this.moveBy={x:t,y:n}},e.MoveBy.prototype=Object.create(e.Action.prototype),e.MoveBy.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.moveFrom={x:t.position.x,y:t.position.y}},e.MoveBy.prototype.perform=function(){this.target.position.x=this.moveFrom.x+this.moveBy.x*this.value,this.target.position.y=this.moveFrom.y+this.moveBy.y*this.value},e.ScaleTo=function(t,n,r){e.Action.call(this,n,r),this.scaleTo=t},e.ScaleTo.prototype=Object.create(e.Action.prototype),e.ScaleTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.scaleFrom=t.scale},e.ScaleTo.prototype.perform=function(){this.target.scale=this.scaleFrom+(this.scaleTo-this.scaleFrom)*this.value},e.ScaleBy=function(t,n,r){e.Action.call(this,n,r),this.scaleBy=t},e.ScaleBy.prototype=Object.create(e.Action.prototype),e.ScaleBy.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.scaleFrom=t.scale},e.ScaleBy.prototype.perform=function(){this.target.scale=this.scaleFrom+this.scaleBy*this.value},e.RotateTo=function(t,n,r){e.Action.call(this,n,r),this.rotateTo=t},e.RotateTo.prototype=Object.create(e.Action.prototype),e.RotateTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.rotateFrom=t.rotation},e.RotateTo.prototype.perform=function(){this.target.rotation=this.rotateFrom+(this.rotateTo-this.rotateFrom)*this.value},e.RotateBy=function(t,n,r){e.Action.call(this,n,r),this.rotateBy=t},e.RotateBy.prototype=Object.create(e.Action.prototype),e.RotateBy.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.rotateFrom=t.rotation},e.RotateBy.prototype.perform=function(){this.target.rotation=this.rotateFrom+this.rotateBy*this.value},e.FadeTo=function(t,n,r){e.Action.call(this,n,r),this.fadeTo=t},e.FadeTo.prototype=Object.create(e.Action.prototype),e.FadeTo.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.fadeFrom=t.opacity},e.FadeTo.prototype.perform=function(){this.target.opacity=this.fadeFrom+(this.fadeTo-this.fadeFrom)*this.value},e.FadeBy=function(t,n,r){e.Action.call(this,n,r),this.fadeBy=t},e.FadeBy.prototype=Object.create(e.Action.prototype),e.FadeBy.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.fadeFrom=t.opacity},e.FadeBy.prototype.perform=function(){this.target.opacity=this.fadeFrom+this.fadeBy*this.value},e.Wait=function(t){e.Action.call(this,t)},e.Wait.prototype=Object.create(e.Action.prototype),e.Call=function(t,n){e.Action.call(this,0),this.func=t,this.args=n},e.Call.prototype=Object.create(e.Action.prototype),e.Call.prototype.perform=function(){if(!this.func)return;this.func(this.args)},e.actionEase={backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return e-=1,e*e*((t+1)*e+t)+1},backInOut:function(e){var t=2.5949095;return e*=2,e<1?e*e*((t+1)*e-t)/2:(e-=2,e*e*((t+1)*e+t)/2+1)},sineIn:function(e){return-1*Math.cos(e*Math.PI/2)+1},sineOut:function(e){return Math.sin(e*(Math.PI/2))},sineInOut:function(e){return-0.5*(Math.cos(Math.PI*e)-1)}},e}(ko||{}),ko=function(e){return e.Sequence=function(e,t){this.actions=e||[],this.repeatCount=t,this.actionIndex=0,this.repeatIndex=0},e.Sequence.prototype=Object.create(e.Action.prototype),e.Sequence.prototype.init=function(t){e.Action.prototype.init.call(this,t),this.actionIndex=0,this.repeatIndex=0},e.Sequence.prototype.update=function(e){if(this.actions.length===0)return;if(this.repeatIndex>=this.repeatCount)return;var t=this.actions[this.actionIndex];!t.target&&this.target&&t.init(this.target),t.update(e);while(t.isComplete()){this.nextAction();if(this.repeatIndex>=this.repeatCount)return;t=this.actions[this.actionIndex],t.duration||t.update(e)}},e.Sequence.prototype.isComplete=function(){return this.repeatCount?this.repeatIndex>=this.repeatCount:!1},e.Sequence.prototype.nextAction=function(){this.actionIndex++,this.actionIndex>=this.actions.length&&(this.actionIndex=0,this.repeatIndex++),this.actions[this.actionIndex].init(this.target)},e.Sequence.prototype.action=function(e){return this.actions.push(e),this},e.Sequence.prototype.moveTo=function(t,n,r,i){return this.actions.push(new e.MoveTo(t,n,r,i)),this},e.Sequence.prototype.moveBy=function(t,n,r,i){return this.actions.push(new e.MoveBy(t,n,r,i)),this},e.Sequence.prototype.scaleTo=function(t,n,r){return this.actions.push(new e.ScaleTo(t,n,r)),this},e.Sequence.prototype.scaleBy=function(t,n,r){return this.actions.push(new e.ScaleBy(t,n,r)),this},e.Sequence.prototype.rotateTo=function(t,n,r){return this.actions.push(new e.RotateTo(t,n,r)),this},e.Sequence.prototype.rotateBy=function(t,n,r){return this.actions.push(new e.RotateBy(t,n,r)),this},e.Sequence.prototype.fadeTo=function(t,n,r){return this.actions.push(new e.FadeTo(t,n,r)),this},e.Sequence.prototype.fadeBy=function(t,n,r){return this.actions.push(new e.FadeBy(t,n,r)),this},e.Sequence.prototype.wait=function(t){return this.actions.push(new e.Wait(t)),this},e.Sequence.prototype.call=function(t,n){return this.actions.push(new e.Call(t,n)),this},e}(ko||{}),ko=function(e){var t=function(){};return t.prototype.update=function(e){if(!this.scene)return;this.scene.handleInput(),this.scene.update(e)},t.prototype.draw=function(){if(!this.scene)return;this.scene.draw()},t.prototype.transitionTo=function(t,n,r,i,s){var o=new e.Transition(this.scene,t,n,r,i,s);return this.scene=o,o},t.prototype.popupTo=function(t,n,r,i){var s=new e.Popup(this.scene,t,n,r,i);return this.scene=s,s},t.prototype.fadeTo=function(t,n,r){r=r||"rgb(0,0,0)";var i=function(){o.fromScene.color=r,o.fromScene.fadeTo(1,n/2,e.actionEase.sineInOut),o.toScene.visible=!1},s=function(){o.fromScene.visible=!1,o.toScene.position={x:0,y:0},o.toScene.color=r,o.toScene.opacity=1,o.toScene.fadeTo(0,n/2,e.actionEase.sineInOut),o.toScene.visible=!0},o=this.transitionTo(t,n,i,s)},t.prototype.slideTo=function(t,n,r,i,s){s=s||e.actionEase.sineInOut;var o=function(){u.fromScene.visible=!0,u.fromScene.moveTo(n,r,i,s),u.toScene.visible=!0,u.toScene.position={x:-n,y:-r},u.toScene.opacity=0,u.toScene.moveTo(0,0,i,s)},u=this.transitionTo(t,i,o)},e.director=new t,e}(ko||{}),ko=function(e){return e.Scene=function(){e.Node.call(this),this.centerAnchor(),this.color="rgb(0,0,0)",this.opacity=0},e.Scene.prototype=Object.create(e.Node.prototype),e.Scene.prototype.draw=function(){if(!this.visible)return;e.Node.prototype.draw.call(this),e.graphics.clear(this.color,this.opacity)},e}(ko||{}),ko=function(e){return e.Transition=function(t,n,r,i,s,o){if(!t)throw new Error("'fromScene' have not been specified when creating transition");if(!n)throw new Error("'toScene' have not been specified when creating transition");e.Scene.call(this),this.fromScene=t,this.toScene=n,r/=2;var u=this,a=new e.Call(function(){e.director.scene=u.toScene});this.performSequence(1).call(i).wait(r).wait(o).call(s).wait(r).action(a),this.onDraw=function(){this.fromScene&&this.fromScene.draw(),this.toScene&&this.toScene.draw()}},e.Transition.prototype=Object.create(e.Scene.prototype),e.Transition.prototype.update=function(t){e.Scene.prototype.update.call(this,t),this.fromScene&&this.fromScene.update(t),this.toScene&&this.toScene.update(t)},e}(ko||{}),ko=function(e){return e.Popup=function(t,n,r,i,s){if(!t)throw new Error("'fromScene' have not been specified when creating popup");if(!n)throw new Error("'toScene' have not been specified when creating popup");e.Scene.call(this),this.fromScene=t,this.toScene=n,this.duration=r,this.transitionOut=i,this.performSequence(1).call(s).wait(r),this.onDraw=function(){this.fromScene.draw(),this.toScene.draw()}},e.Popup.prototype=Object.create(e.Scene.prototype),e.Popup.prototype.update=function(t){e.Scene.prototype.update.call(this,t),this.fromScene.update(t),this.toScene.update(t)},e.Popup.prototype.handleInput=function(){e.Scene.prototype.handleInput.call(this),this.toScene.handleInput()},e.Popup.prototype.close=function(){var t=this,n=new e.Call(function(){e.director.scene=t.fromScene});this.performSequence(1).call(t.transitionOut).wait(this.duration).action(n)},e}(ko||{}),ko=function(e){return e.Menu=function(t,n,r){if(!r)throw new Error("Can't create menu without any items.");e.Node.call(this),this.itemColor="rgb(50,50,50)",this.selectedItemColor="rgb(255,255,255)",this.selectedItemIndex=0,this.spacing=10,this.fontSize=t,this.font=t+"px "+n,this.items=r,this.createLabels(),this.alignItemsCenter()},e.Menu.prototype=Object.create(e.Node.prototype),e.Menu.prototype.update=function(t){e.Node.prototype.update.call(this,t);for(var n=0;n<this.labels.length;n++)this.labels[n].color=n===this.selectedItemIndex?this.selectedItemColor:this.itemColor},e.Menu.prototype.handleInput=function(){e.keyboard.wasKeyHeld(e.keyboard.UP)&&this.selectPreviousItem(),e.keyboard.wasKeyHeld(e.keyboard.DOWN)&&this.selectNextItem(),e.keyboard.wasKeyPressed(e.keyboard.ENTER)&&this.chooseSelectedItem()},e.Menu.prototype.createLabels=function(){this.labels=[];for(var t=0;t<this.items.length;t++){var n=new e.Label(this.items[t],this.font);n.align="center",n.baseline="middle",this.labels.push(n),this.addChild(n)}},e.Menu.prototype.alignItemsCenter=function(){var t=this,n=function(e){var n=t.labels.length-1,r=t.spacing,i=t.fontSize;return-(n*i+n*r)/2+(i+r)*e};for(var r=0;r<this.items.length;r++)this.labels[r].position.y=n(r);this.setPosition(e.graphics.center)},e.Menu.prototype.selectNextItem=function(){this.selectedItemIndex<this.items.length-1&&(this.selectedItemIndex++,this.selectedItemChanged())},e.Menu.prototype.selectPreviousItem=function(){this.selectedItemIndex>0&&(this.selectedItemIndex--,this.selectedItemChanged())},e.Menu.prototype.selectedItemChanged=function(){if(!this.onSelectedItemChanged)return;this.onSelectedItemChanged()},e.Menu.prototype.chooseSelectedItem=function(){if(!this.onSelectedItemChosen)return;this.onSelectedItemChosen()},e}(ko||{}),ko=function(e){return e.Audio=function(){this.sounds=[]},e.Audio.prototype.playSound=function(e,t,n,r){var i=new Audio(e);i.id=n,i.volume=r||1,i.loop=t,i.play(),this.sounds.push(i)},e.Audio.prototype.playMusic=function(e,t,n){this.music=new Audio(e),this.music.volume=n||1,this.music.loop=t,this.music.play()},e.Audio.prototype.stopSound=function(e){if(e===undefined)throw new Error("Must specify 'id' when stopping a sound.");for(var t=0;t<this.sounds.length;t++)if(this.sounds[t].id===e){this.sounds[t].pause(),this.sounds.splice(t,1);break}},e.Audio.prototype.stopMusic=function(){if(!this.music)throw new Error("Can't stop music before music has been played.");this.music.pause()},e.Audio.prototype.stopAllSounds=function(){for(var e=this.sounds.length-1;e>=0;e--)this.sounds[e].pause(),this.sounds.splice(e,1)},e.Audio.prototype.fadeMusic=function(t,n){if(!this.music)throw new Error("Can't fade music before music has been played.");this.fadeFrom=this.music.volume,this.fadeTo=t,this.fadeAction=new e.Action(n||1),this.fadeAction.init(this)},e.Audio.prototype.isMusicPlaying=function(){return this.music?!this.music.paused:!1},e.Audio.prototype.update=function(e){if(!this.fadeAction)return;this.fadeAction.update(e),this.music.volume=this.fadeFrom+(this.fadeTo-this.fadeFrom)*this.fadeAction.value,this.fadeAction.isComplete()&&delete this.fadeAction},e.audio=new e.Audio,e}(ko||{});